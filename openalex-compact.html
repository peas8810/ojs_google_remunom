<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>

  <!-- Editorial feel: serif headline + neutral sans -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700;800&family=Source+Serif+4:opsz,wght@8..60,600;8..60,700&display=swap" rel="stylesheet">

  <style>
    :root{
      --paper:#ffffff;
      --ink:#111827;
      --muted:#6b7280;
      --muted2:#9ca3af;
      --line:#e5e7eb;
      --line2:#f3f4f6;
      --accent:#d10a1f;     /* editorial red */
      --accent2:#7f0a14;
      --shadow: 0 1px 0 rgba(17,24,39,.04), 0 10px 22px rgba(17,24,39,.07);
      --radius:16px;
    }

    body{
      margin:0;
      background:transparent;
      color:var(--ink);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }

    .card{
      background:var(--paper);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }

    /* Header with editorial stripe */
    .hd{
      padding:12px 12px 10px;
      border-bottom:1px solid var(--line2);
      position:relative;
    }
    .hd:before{
      content:"";
      position:absolute;
      left:0; top:0;
      width:6px; height:100%;
      background:linear-gradient(180deg,var(--accent),var(--accent2));
    }
    .hd-inner{padding-left:10px;}
    .kicker{
      font-size:10px;
      font-weight:800;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:var(--muted);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .dot{
      width:6px;height:6px;border-radius:999px;background:var(--accent);
      box-shadow:0 0 0 2px rgba(209,10,31,.12);
      flex:0 0 auto;
    }
    .title{
      margin:6px 0 2px;
      font-family:"Source Serif 4", serif;
      font-weight:700;
      font-size:14px;
      line-height:1.15;
      letter-spacing:-.01em;
    }
    .sub{
      margin:0;
      font-size:11px;
      color:var(--muted);
      font-weight:600;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:260px;
    }

    .wrap{padding:10px 12px 12px;}

    .chartBox{
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px 10px 6px;
      background:linear-gradient(180deg,#fff,#fbfbfb);
    }
    canvas{width:100% !important;height:92px !important;}

    .stats{
      display:grid;
      grid-template-columns:repeat(3,minmax(0,1fr));
      gap:10px;
      margin:10px 0 10px;
    }
    .stat{
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px;
      background:#fff;
    }
    .stat .k{
      font-size:10px;
      font-weight:800;
      letter-spacing:.10em;
      text-transform:uppercase;
      color:var(--muted2);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .bar{
      width:16px;height:2px;border-radius:999px;background:rgba(209,10,31,.35);
    }
    .stat .v{
      margin-top:6px;
      font-size:14px;
      font-weight:800;
      letter-spacing:-.01em;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .stat .v small{
      font-size:11px;
      font-weight:800;
      color:var(--muted);
    }

    .rank{
      border:1px solid var(--line);
      border-radius:14px;
      background:#fff;
      padding:10px;
    }
    .rankT{
      margin:0 0 8px;
      font-size:10px;
      font-weight:900;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:var(--muted2);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .chip{
      font-size:10px;
      font-weight:900;
      letter-spacing:.06em;
      color:var(--accent2);
      border:1px solid rgba(209,10,31,.25);
      background:rgba(209,10,31,.06);
      padding:4px 8px;
      border-radius:999px;
      white-space:nowrap;
    }

    .rrow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:8px 0;
      border-top:1px dashed rgba(156,163,175,.35);
    }
    .rrow:first-of-type{border-top:0;padding-top:0;}
    .left{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .med{
      width:26px;height:26px;
      border-radius:999px;
      display:grid;
      place-items:center;
      border:1px solid var(--line);
      background:radial-gradient(circle at 30% 30%, rgba(209,10,31,.14), rgba(17,24,39,.02));
      font-size:13px;
      flex:0 0 auto;
    }
    .yr{
      font-size:12px;
      font-weight:900;
      letter-spacing:-.01em;
    }
    .ct{
      font-size:12px;
      font-weight:900;
      color:var(--ink);
      padding:6px 10px;
      border:1px solid var(--line);
      border-radius:999px;
      background:#fff;
    }

    .foot{
      margin-top:10px;
      padding-top:10px;
      border-top:1px solid var(--line2);
      font-size:11px;
      color:var(--muted2);
      font-weight:700;
      display:flex;
      justify-content:space-between;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }
    a{color:inherit;text-decoration:none}
    a:hover{text-decoration:underline}

    @media (max-width: 420px){
      .sub{max-width:200px;}
      canvas{height:86px !important;}
      .stats{gap:8px;}
    }
  </style>
</head>

<body>
  <div class="card">
    <div class="hd">
      <div class="hd-inner">
        <div class="kicker"><span class="dot"></span> OpenAlex Metrics</div>
        <div class="title">REMUNOM</div>
        <p class="sub" id="range">Annual distribution</p>
      </div>
    </div>

    <div class="wrap">
      <div class="chartBox"><canvas id="chart"></canvas></div>

      <div class="stats">
        <div class="stat">
          <div class="k"><span class="bar"></span>Total</div>
          <div class="v" id="total">—</div>
        </div>
        <div class="stat">
          <div class="k"><span class="bar"></span>Top year</div>
          <div class="v" id="champ">—</div>
        </div>
        <div class="stat">
          <div class="k"><span class="bar"></span>Latest</div>
          <div class="v" id="last">—</div>
        </div>
      </div>

      <div class="rank">
        <div class="rankT">
          <span>Top 3 years</span>
          <span class="chip">annual output</span>
        </div>
        <div id="rank"></div>
      </div>

      <div class="foot">
        <div>Source: OpenAlex</div>
        <div><a id="jsonlink" href="#" target="_blank" rel="noopener">View JSON</a></div>
      </div>
    </div>
  </div>

<script>
(async function(){
  // ✅ Correct repo (from your screenshot)
  const RAW = "https://raw.githubusercontent.com/peas8810/ojs_google_remunom/main/openalex.json";

  const $ = (id)=>document.getElementById(id);
  $("jsonlink").href = RAW;

  const res = await fetch(RAW + "?t=" + Date.now(), { cache:"no-store" });
  if(!res.ok) throw new Error("HTTP " + res.status);
  const data = await res.json();

  $("total").textContent = String(data?.meta?.count ?? "—");

  const rows = (Array.isArray(data.group_by) ? data.group_by : [])
    .map(g => ({ year: String(g.key_display_name ?? g.key ?? ""), count: Number(g.count ?? 0) }))
    .filter(r => r.year && Number.isFinite(r.count))
    .sort((a,b)=> Number(a.year) - Number(b.year));

  if(!rows.length) return;

  const years = rows.map(r=>r.year);
  const counts = rows.map(r=>r.count);

  $("range").textContent = `Annual distribution • ${years[0]}–${years[years.length-1]}`;

  const champ = rows.reduce((p,c)=> c.count > p.count ? c : p, rows[0]);
  $("champ").innerHTML = `${champ.year} <small>(${champ.count})</small>`;

  const lastRow = rows[rows.length-1];
  $("last").innerHTML = `${lastRow.year} <small>(${lastRow.count})</small>`;

  new Chart(document.getElementById("chart"), {
    type: "bar",
    data: {
      labels: years,
      datasets: [{
        data: counts,
        borderWidth: 0,
        borderRadius: 8,
        barThickness: 18,
        maxBarThickness: 22
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display:false },
        tooltip: {
          enabled:true,
          callbacks: {
            title: (items)=> `Year ${items?.[0]?.label ?? ""}`,
            label: (item)=> `Total: ${item?.raw ?? ""}`
          }
        }
      },
      scales: {
        x: {
          grid: { display:false },
          ticks:{ font:{ family:"Inter", size:10, weight:"800" } }
        },
        y: {
          display:false,
          beginAtZero:true
        }
      }
    }
  });

  const top3 = [...rows].sort((a,b)=> b.count - a.count).slice(0,3);
  const medals = ["1°","2°","3°"];
  const rankEl = $("rank");
  rankEl.innerHTML = "";
  top3.forEach((r, i) => {
    const div = document.createElement("div");
    div.className = "rrow";
    div.innerHTML = `
      <div class="left">
        <div class="med">${medals[i]}</div>
        <div class="yr">${r.year}</div>
      </div>
      <div class="ct">${r.count}</div>
    `;
    rankEl.appendChild(div);
  });
})();
</script>

</body>
</html>
